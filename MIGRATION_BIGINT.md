# üîß –ú–∏–≥—Ä–∞—Ü–∏—è: INTEGER ‚Üí BIGINT –¥–ª—è –ø–æ–ª—è id

## –ü—Ä–æ–±–ª–µ–º–∞

Telegram ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–æ–≥—É—Ç –±—ã—Ç—å –æ—á–µ–Ω—å –±–æ–ª—å—à–∏–º–∏ (–¥–æ 64 –±–∏—Ç), –Ω–æ PostgreSQL –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–∏–ø `INTEGER` (32 –±–∏—Ç), –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–æ 2,147,483,647. 

ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `5631774669` –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ —ç—Ç–∏ –ø—Ä–µ–¥–µ–ª—ã, —á—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É:
```
invalid input for query argument $1: 5631774669 (value out of int32 range)
```

## –†–µ—à–µ–Ω–∏–µ

–¢–∏–ø –ø–æ–ª—è `id` –≤ –º–æ–¥–µ–ª–∏ `User` –∏–∑–º–µ–Ω–µ–Ω —Å `Integer` –Ω–∞ `BigInteger` (64 –±–∏—Ç).

## –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å –¥–∞–Ω–Ω—ã–º–∏, –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é.

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (—á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç)

**–í Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:**

```bash
# 1. –ó–∞–π–¥–∏—Ç–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker exec -it zodiac_bot bash

# 2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
python migrate_to_bigint.py

# 3. –í—ã–π–¥–∏—Ç–µ –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
exit
```

**–ò–ª–∏ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π:**

```bash
docker exec -it zodiac_bot python migrate_to_bigint.py
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ psql

**–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ PostgreSQL:**

```bash
docker exec -it zodiac_postgres psql -U –≤–∞—à_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -d –≤–∞—à–∞_–±–∞–∑–∞
```

**–í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL –∫–æ–º–∞–Ω–¥—É:**

```sql
ALTER TABLE users ALTER COLUMN id TYPE BIGINT;
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**

```sql
SELECT data_type 
FROM information_schema.columns 
WHERE table_name = 'users' AND column_name = 'id';
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `bigint`

**–í—ã–π–¥–∏—Ç–µ:**

```sql
\q
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ï—Å–ª–∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø—É—Å—Ç–∞—è –∏–ª–∏ –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å

–ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# –£–¥–∞–ª–∏—Ç–µ —Ç–æ–º —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö (–û–°–¢–û–†–û–ñ–ù–û - —ç—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ!)
docker volume rm tg-zodiac_postgres_data

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
docker-compose up -d --build
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:
```bash
docker-compose restart bot
```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
docker-compose logs -f bot
```

3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `/start` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å –±–æ–ª—å—à–∏–º ID.

## –ß—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–æ –≤ –∫–æ–¥–µ

- `database.py`: –ü–æ–ª–µ `id` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `BigInteger` –≤–º–µ—Å—Ç–æ `Integer`
- –î–æ–±–∞–≤–ª–µ–Ω —Å–∫—Ä–∏–ø—Ç `migrate_to_bigint.py` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

---

**–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞, –æ—à–∏–±–∫–∞ –±—É–¥–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å—Å—è!

